# 工程检测因果分析系统

## 项目简介

本项目对工程材料检测数据进行因果分析，识别影响检测合格率和检测价格的关键因素。

## 数据概览

- **数据源**: `data/processed/cleaned_data.csv`
- **样本数量**: 8,498 条检测记录
- **检测合格率**: 98.99% (8,412/8,498)
- **不合格样本**: 81 条

## 关键变量

### 结果变量 (Outcome)
- **是否合格**: 检测结果（合格/不合格）
- **价格**: 检测费用（1-1000元）
- **检测状态**: 完成状态（已完成/未完成）

### 处理变量 (Treatment)
- **强度等级**: 材料强度等级（HRB335, HRB400等）
- **品种**: 材料品种（32种）
- **规格**: 材料规格尺寸

### 混杂因素 (Confounders)
- **生产厂家**: 材料供应商（244家）
- **施工单位**: 施工方（21家）
- **监理单位**: 监理方
- **检验类别**: 委托检验/工程现场抽检/监督抽检
- **结构部位**: 使用部位（车站主体/冠梁/底板等）

### 工具变量 (Instruments)
- **委托单位**: 委托检测的单位
- **委托组号**: 批次编号

## 因果问题

1. **归因分析**: 哪些因素导致了不合格率的变化？
2. **干预分析**: 更换生产厂家、提高强度等级对合格率的因果效应？
3. **反事实分析**: 如果某个不合格样本使用了不同的生产厂家，结果会如何？

## 文件结构

```
engineering_inspection_analysis/
├── README.md                    # 项目说明
├── data/                        # 数据目录（软链接到主项目）
├── src/                         # 源代码
│   ├── __init__.py
│   ├── data_preprocessing.py    # 数据预处理
│   ├── inspection_causal_model.py  # 因果模型
│   └── visualization.py         # 可视化工具
├── results/                     # 分析结果
│   ├── figures/                 # 图表
│   └── reports/                 # 报告
├── notebooks/                   # Jupyter notebooks
└── inspection_analysis_demo.py  # 演示脚本
```

## 使用方法

```bash
# 1. 运行完整分析
python inspection_analysis_demo.py

# 2. 查看结果
ls results/figures/
ls results/reports/
```

## 因果分析流程

1. **数据预处理**: 处理缺失值、编码分类变量
2. **构建因果图**: 基于领域知识建立变量间的因果关系
3. **拟合因果模型**: 使用Pyro构建深度因果模型
4. **归因分析**: 识别不合格率变化的根本原因
5. **干预分析**: 评估不同干预措施的效果
6. **反事实分析**: 探索"如果...会怎样"的问题

## 主要发现（待更新）

分析完成后将在此处更新主要发现和建议。

## 依赖环境

- Python 3.8+
- pandas, numpy
- pyro-ppl
- networkx
- matplotlib, seaborn

## 作者

基于 `causalmodel` 项目框架开发

