<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å› æœåˆ†ææ™ºèƒ½ä½“ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .reference-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .reference-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .samples-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .sample-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sample-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .sample-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .sample-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .sample-card .param {
            font-size: 0.9em;
            color: #666;
            margin: 5px 0;
        }

        .sample-card .strength {
            font-weight: bold;
            color: #2ecc71;
            margin-top: 10px;
        }

        .query-section {
            margin-bottom: 30px;
        }

        .query-section h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .examples {
            background: #fff8e1;
            border-left: 4px solid #ffa726;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .examples h4 {
            color: #f57c00;
            margin-bottom: 10px;
        }

        .examples ul {
            list-style: none;
            padding-left: 0;
        }

        .examples li {
            padding: 5px 0;
            color: #666;
            cursor: pointer;
        }

        .examples li:hover {
            color: #667eea;
            text-decoration: underline;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .loading.active {
            display: block;
        }

        .result-section {
            display: none;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .result-section.active {
            display: block;
        }

        .result-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .result-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .result-item h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .result-item pre {
            background: white;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 0.9em;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .badge-attribution {
            background: #e3f2fd;
            color: #1976d2;
        }

        .badge-intervention {
            background: #fff3e0;
            color: #f57c00;
        }

        .badge-counterfactual {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 15px 30px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .predictor-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .predictor-section h3 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .param-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .param-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
        }

        .param-item label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .param-item .param-info {
            font-size: 0.85em;
            color: #999;
            margin-bottom: 10px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider-container input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .slider-container input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .slider-container input[type="number"] {
            width: 80px;
            padding: 5px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            text-align: center;
        }

        .predict-result {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border-left: 5px solid #2ecc71;
        }

        .predict-result.active {
            display: block;
        }

        .strength-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .strength-display .value {
            font-size: 3em;
            font-weight: bold;
        }

        .strength-display .label {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .preset-configs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .preset-btn {
            padding: 10px 15px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .preset-btn:hover {
            background: #667eea;
            color: white;
        }

        .weights-chart {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
        }

        .weights-chart h4 {
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
        }

        .weight-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .weight-label {
            width: 150px;
            font-weight: bold;
            color: #333;
        }

        .weight-bar-container {
            flex: 1;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .weight-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
            transition: width 0.5s ease;
        }

        .weight-bar.positive {
            background: linear-gradient(90deg, #2ecc71 0%, #27ae60 100%);
        }

        .weight-bar.negative {
            background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%);
        }

        .weight-value {
            margin-left: 10px;
            width: 80px;
            text-align: right;
            font-weight: bold;
            color: #667eea;
        }

        .weight-effect {
            margin-left: 10px;
            font-size: 0.85em;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ å› æœåˆ†ææ™ºèƒ½ä½“ç³»ç»Ÿ</h1>
            <p>æ··å‡åœŸé…åˆæ¯”è´¨é‡æ§åˆ¶ä¸ä¼˜åŒ–</p>
        </div>

        <div class="main-card">
            <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('predictor')">ğŸ”® å¼ºåº¦é¢„æµ‹</button>
                <button class="tab" onclick="switchTab('analysis')">ğŸ”¬ å› æœåˆ†æ</button>
            </div>

            <!-- å¼ºåº¦é¢„æµ‹æ ‡ç­¾é¡µ -->
            <div id="predictorTab" class="tab-content active">
                <div class="predictor-section">
                    <h3>ğŸ”® æ··å‡åœŸå¼ºåº¦é¢„æµ‹å™¨</h3>
                    <p style="color: #666; margin-bottom: 20px;">
                        è°ƒæ•´é…åˆæ¯”å‚æ•°ï¼Œå®æ—¶é¢„æµ‹æ··å‡åœŸæŠ—å‹å¼ºåº¦
                    </p>

                    <!-- é¢„è®¾é…ç½® -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #333; margin-bottom: 10px;">ğŸ’¡ å¿«é€Ÿé¢„è®¾</h4>
                        <div class="preset-configs">
                            <button class="preset-btn" onclick="applyPreset('c30')">C30 å¸¸è§„é…åˆæ¯”</button>
                            <button class="preset-btn" onclick="applyPreset('c40')">C40 ä¸­å¼ºé…åˆæ¯”</button>
                            <button class="preset-btn" onclick="applyPreset('c50')">C50 é«˜å¼ºé…åˆæ¯”</button>
                            <button class="preset-btn" onclick="applyPreset('lowwater')">ä½æ°´èƒ¶æ¯”é…åˆæ¯”</button>
                        </div>
                    </div>

                    <!-- å‚æ•°è¾“å…¥ -->
                    <div class="param-group">
                        <!-- æ°´æ³¥ -->
                        <div class="param-item">
                            <label>æ°´æ³¥ (Cement)</label>
                            <div class="param-info">èŒƒå›´: 100-600 kg/mÂ³</div>
                            <div class="slider-container">
                                <input type="range" id="cement" min="100" max="600" value="280" step="10" oninput="updateParamValue('cement')">
                                <input type="number" id="cementValue" min="100" max="600" value="280" oninput="updateParamSlider('cement')">
                            </div>
                        </div>

                        <!-- é«˜ç‚‰çŸ¿æ¸£ -->
                        <div class="param-item">
                            <label>é«˜ç‚‰çŸ¿æ¸£ (Blast Furnace Slag)</label>
                            <div class="param-info">èŒƒå›´: 0-400 kg/mÂ³</div>
                            <div class="slider-container">
                                <input type="range" id="slag" min="0" max="400" value="100" step="10" oninput="updateParamValue('slag')">
                                <input type="number" id="slagValue" min="0" max="400" value="100" oninput="updateParamSlider('slag')">
                            </div>
                        </div>

                        <!-- ç²‰ç…¤ç° -->
                        <div class="param-item">
                            <label>ç²‰ç…¤ç° (Fly Ash)</label>
                            <div class="param-info">èŒƒå›´: 0-250 kg/mÂ³</div>
                            <div class="slider-container">
                                <input type="range" id="flyash" min="0" max="250" value="50" step="10" oninput="updateParamValue('flyash')">
                                <input type="number" id="flyashValue" min="0" max="250" value="50" oninput="updateParamSlider('flyash')">
                            </div>
                        </div>

                        <!-- æ°´ -->
                        <div class="param-item">
                            <label>æ°´ (Water)</label>
                            <div class="param-info">èŒƒå›´: 100-300 kg/mÂ³</div>
                            <div class="slider-container">
                                <input type="range" id="water" min="100" max="300" value="180" step="5" oninput="updateParamValue('water')">
                                <input type="number" id="waterValue" min="100" max="300" value="180" oninput="updateParamSlider('water')">
                            </div>
                        </div>

                        <!-- é«˜æ•ˆå‡æ°´å‰‚ -->
                        <div class="param-item">
                            <label>é«˜æ•ˆå‡æ°´å‰‚ (Superplasticizer)</label>
                            <div class="param-info">èŒƒå›´: 0-40 kg/mÂ³</div>
                            <div class="slider-container">
                                <input type="range" id="sp" min="0" max="40" value="8" step="1" oninput="updateParamValue('sp')">
                                <input type="number" id="spValue" min="0" max="40" value="8" oninput="updateParamSlider('sp')">
                            </div>
                        </div>

                        <!-- ç²—éª¨æ–™ -->
                        <div class="param-item">
                            <label>ç²—éª¨æ–™ (Coarse Aggregate)</label>
                            <div class="param-info">èŒƒå›´: 700-1200 kg/mÂ³</div>
                            <div class="slider-container">
                                <input type="range" id="coarse" min="700" max="1200" value="1000" step="10" oninput="updateParamValue('coarse')">
                                <input type="number" id="coarseValue" min="700" max="1200" value="1000" oninput="updateParamSlider('coarse')">
                            </div>
                        </div>

                        <!-- ç»†éª¨æ–™ -->
                        <div class="param-item">
                            <label>ç»†éª¨æ–™ (Fine Aggregate)</label>
                            <div class="param-info">èŒƒå›´: 500-1100 kg/mÂ³</div>
                            <div class="slider-container">
                                <input type="range" id="fine" min="500" max="1100" value="800" step="10" oninput="updateParamValue('fine')">
                                <input type="number" id="fineValue" min="500" max="1100" value="800" oninput="updateParamSlider('fine')">
                            </div>
                        </div>

                        <!-- é¾„æœŸ -->
                        <div class="param-item">
                            <label>é¾„æœŸ (Age)</label>
                            <div class="param-info">èŒƒå›´: 1-365 å¤©</div>
                            <div class="slider-container">
                                <input type="range" id="age" min="1" max="365" value="28" step="1" oninput="updateParamValue('age')">
                                <input type="number" id="ageValue" min="1" max="365" value="28" oninput="updateParamSlider('age')">
                            </div>
                        </div>
                    </div>

                    <!-- é¢„æµ‹æŒ‰é’® -->
                    <button class="btn" onclick="predictStrength()">
                        ğŸš€ é¢„æµ‹å¼ºåº¦
                    </button>

                    <!-- é¢„æµ‹ç»“æœ -->
                    <div id="predictResult" class="predict-result">
                        <div class="strength-display">
                            <div class="label">é¢„æµ‹æŠ—å‹å¼ºåº¦</div>
                            <div class="value" id="predictedStrength">--</div>
                            <div class="label">MPa</div>
                        </div>
                        <div id="predictInterpretation" style="white-space: pre-line; color: #333; line-height: 1.6;"></div>
                        
                        <!-- æƒé‡å›¾ -->
                        <div id="weightsChart" class="weights-chart" style="display: none;">
                            <h4>ğŸ“Š æ··å‡åœŸå¼ºåº¦å½±å“å› ç´ æƒé‡åˆ†æ</h4>
                            <p style="color: #666; text-align: center; margin-bottom: 20px; font-size: 0.9em;">
                                åŸºäºå› æœæ¨æ–­çš„ç‰¹å¾é‡è¦æ€§åˆ†æï¼ˆçº¿æ¡ç²—ç»†ä»£è¡¨æƒé‡å¤§å°ï¼Œé¢œè‰²ä»£è¡¨è´¨é‡è¯„åˆ†ï¼‰
                            </p>
                            <div id="weightsContainer"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å› æœåˆ†ææ ‡ç­¾é¡µ -->
            <div id="analysisTab" class="tab-content">
            <!-- å‚è€ƒæ‰¹æ¬¡é€‰æ‹© -->
            <div class="reference-section">
                <h3>ğŸ“¦ é€‰æ‹©å‚è€ƒæ‰¹æ¬¡ï¼ˆåäº‹å®åˆ†æéœ€è¦ï¼‰</h3>
                <p style="color: #666; margin-bottom: 15px;">
                    å½’å› åˆ†æå’Œå¹²é¢„åˆ†æä¸éœ€è¦é€‰æ‹©æ‰¹æ¬¡ï¼Œåäº‹å®åˆ†æå»ºè®®é€‰æ‹©ä¸€ä¸ªå‚è€ƒæ‰¹æ¬¡
                </p>
                <div id="samplesGrid" class="samples-grid">
                    <div class="sample-card">åŠ è½½ä¸­...</div>
                </div>
            </div>

            <!-- æŸ¥è¯¢è¾“å…¥ -->
            <div class="query-section">
                <h3>ğŸ’¬ æå‡ºæ‚¨çš„é—®é¢˜</h3>
                
                <!-- ç¤ºä¾‹é—®é¢˜ -->
                <div class="examples">
                    <h4>ğŸ’¡ ç¤ºä¾‹é—®é¢˜ï¼ˆç‚¹å‡»å¿«é€Ÿå¡«å……ï¼‰</h4>
                    <ul>
                        <li onclick="fillQuery('ä¸ºä»€ä¹ˆæ··å‡åœŸæŠ—å‹å¼ºåº¦ä¸‹é™äº†ï¼Ÿ')">ğŸ“Š ä¸ºä»€ä¹ˆæ··å‡åœŸæŠ—å‹å¼ºåº¦ä¸‹é™äº†ï¼Ÿ</li>
                        <li onclick="fillQuery('å¦‚ä½•æé«˜æ··å‡åœŸå¼ºåº¦ï¼Ÿ')">ğŸ”§ å¦‚ä½•æé«˜æ··å‡åœŸå¼ºåº¦ï¼Ÿ</li>
                        <li onclick="fillQuery('å¦‚æœæ°´ç”¨é‡ä»200é™åˆ°150 kg/mÂ³ï¼Œå¼ºåº¦ä¼šæå‡å¤šå°‘ï¼Ÿ')">ğŸ”® å¦‚æœæ°´ç”¨é‡ä»200é™åˆ°150ï¼Œå¼ºåº¦ä¼šæå‡å¤šå°‘ï¼Ÿ</li>
                        <li onclick="fillQuery('å¢åŠ æ°´æ³¥ç”¨é‡50 kg/mÂ³ï¼Œå¼ºåº¦èƒ½æå‡å¤šå°‘ï¼Ÿ')">ğŸ“ˆ å¢åŠ æ°´æ³¥ç”¨é‡50 kg/mÂ³ï¼Œå¼ºåº¦èƒ½æå‡å¤šå°‘ï¼Ÿ</li>
                        <li onclick="fillQuery('æ·»åŠ çŸ¿æ¸£100 kg/mÂ³ä¼šæ€æ ·ï¼Ÿ')">ğŸ­ æ·»åŠ çŸ¿æ¸£100 kg/mÂ³ä¼šæ€æ ·ï¼Ÿ</li>
                    </ul>
                </div>

                <div class="input-group">
                    <textarea id="queryInput" placeholder="åœ¨æ­¤è¾“å…¥æ‚¨çš„é—®é¢˜...&#10;ä¾‹å¦‚ï¼šå¦‚æœæ°´æ³¥280 kg/mÂ³ã€æ°´180 kg/mÂ³ã€é¾„æœŸ28å¤©ï¼Œé¢„æµ‹å¼ºåº¦æ˜¯å¤šå°‘ï¼Ÿ"></textarea>
                </div>

                <button class="btn" onclick="analyzeQuery()">
                    ğŸš€ å¼€å§‹åˆ†æ
                </button>
            </div>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="loading" class="loading">
                <p>â³ åˆ†æä¸­ï¼Œè¯·ç¨å€™...</p>
                <p style="font-size: 0.9em; margin-top: 10px;">è¿™å¯èƒ½éœ€è¦5-30ç§’</p>
            </div>

            <!-- ç»“æœå±•ç¤º -->
            <div id="resultSection" class="result-section">
                <div class="result-header">
                    <h2>ğŸ“Š åˆ†æç»“æœ</h2>
                </div>

                <div class="result-item">
                    <h4>ğŸ¯ åˆ†æç±»å‹</h4>
                    <p id="analysisType">-</p>
                </div>

                <div class="result-item">
                    <h4>ğŸ“ˆ ç›®æ ‡å˜é‡</h4>
                    <p id="targetVariable">-</p>
                </div>

                <div class="result-item">
                    <h4>ğŸ“ åˆ†ææ‘˜è¦</h4>
                    <p id="analysisSummary">-</p>
                </div>

                <div class="result-item">
                    <h4>ğŸ’¡ å†³ç­–å»ºè®®</h4>
                    <pre id="recommendations">-</pre>
                </div>

                <div class="result-item">
                    <h4>ğŸ“Š è¯¦ç»†ç»“æœ</h4>
                    <pre id="detailedResults">-</pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedSampleIndex = null;
        const API_BASE = 'http://localhost:8000';

        // é¡µé¢åŠ è½½æ—¶è·å–å‚è€ƒæ‰¹æ¬¡
        window.addEventListener('load', async () => {
            await loadSamples();
        });

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            // ç§»é™¤æ‰€æœ‰activeç±»
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // æ·»åŠ activeç±»åˆ°å½“å‰æ ‡ç­¾
            if (tabName === 'predictor') {
                document.querySelector('.tab:first-child').classList.add('active');
                document.getElementById('predictorTab').classList.add('active');
            } else if (tabName === 'analysis') {
                document.querySelector('.tab:last-child').classList.add('active');
                document.getElementById('analysisTab').classList.add('active');
            }
        }

        // æ›´æ–°å‚æ•°å€¼ï¼ˆä»æ»‘åŠ¨æ¡ï¼‰
        function updateParamValue(paramName) {
            const slider = document.getElementById(paramName);
            const input = document.getElementById(paramName + 'Value');
            input.value = slider.value;
        }

        // æ›´æ–°æ»‘åŠ¨æ¡ï¼ˆä»è¾“å…¥æ¡†ï¼‰
        function updateParamSlider(paramName) {
            const slider = document.getElementById(paramName);
            const input = document.getElementById(paramName + 'Value');
            slider.value = input.value;
        }

        // åº”ç”¨é¢„è®¾é…ç½®
        function applyPreset(presetName) {
            const presets = {
                'c30': {
                    cement: 300,
                    slag: 0,
                    flyash: 0,
                    water: 185,
                    sp: 3,
                    coarse: 1050,
                    fine: 850,
                    age: 28
                },
                'c40': {
                    cement: 380,
                    slag: 50,
                    flyash: 30,
                    water: 170,
                    sp: 8,
                    coarse: 1000,
                    fine: 800,
                    age: 28
                },
                'c50': {
                    cement: 450,
                    slag: 100,
                    flyash: 50,
                    water: 160,
                    sp: 12,
                    coarse: 980,
                    fine: 780,
                    age: 28
                },
                'lowwater': {
                    cement: 400,
                    slag: 150,
                    flyash: 80,
                    water: 150,
                    sp: 15,
                    coarse: 950,
                    fine: 750,
                    age: 28
                }
            };

            const preset = presets[presetName];
            if (preset) {
                // è®¾ç½®æ‰€æœ‰å‚æ•°
                Object.keys(preset).forEach(key => {
                    document.getElementById(key).value = preset[key];
                    document.getElementById(key + 'Value').value = preset[key];
                });
            }
        }

        // æ˜¾ç¤ºæƒé‡å›¾
        function displayWeightsChart(weights) {
            const container = document.getElementById('weightsContainer');
            const chartDiv = document.getElementById('weightsChart');
            
            // æ¸…ç©ºå®¹å™¨
            container.innerHTML = '';
            
            // è½¬æ¢ä¸ºæ•°ç»„å¹¶æŒ‰æƒé‡æ’åº
            const weightArray = Object.entries(weights).map(([key, value]) => ({
                key: key,
                ...value
            })).sort((a, b) => b.weight_pct - a.weight_pct);
            
            // æ‰¾å‡ºæœ€å¤§æƒé‡ç”¨äºå½’ä¸€åŒ–
            const maxWeight = Math.max(...weightArray.map(w => w.weight_pct));
            
            // åˆ›å»ºæƒé‡æ¡
            weightArray.forEach(weight => {
                const item = document.createElement('div');
                item.className = 'weight-item';
                
                const barClass = weight.causal_effect >= 0 ? 'positive' : 'negative';
                const direction = weight.causal_effect >= 0 ? 'â†‘' : 'â†“';
                
                item.innerHTML = `
                    <div class="weight-label">${weight.name}</div>
                    <div class="weight-bar-container">
                        <div class="weight-bar ${barClass}" style="width: ${(weight.weight_pct / maxWeight * 100)}%">
                            ${weight.weight_pct.toFixed(1)}%
                        </div>
                    </div>
                    <div class="weight-value">${direction} ${Math.abs(weight.causal_effect).toFixed(2)}</div>
                    <div class="weight-effect">è¯„åˆ†: ${weight.score}</div>
                `;
                
                container.appendChild(item);
            });
            
            // æ˜¾ç¤ºæƒé‡å›¾
            chartDiv.style.display = 'block';
        }

        // é¢„æµ‹å¼ºåº¦
        async function predictStrength() {
            const params = {
                cement: parseFloat(document.getElementById('cementValue').value),
                blast_furnace_slag: parseFloat(document.getElementById('slagValue').value),
                fly_ash: parseFloat(document.getElementById('flyashValue').value),
                water: parseFloat(document.getElementById('waterValue').value),
                superplasticizer: parseFloat(document.getElementById('spValue').value),
                coarse_aggregate: parseFloat(document.getElementById('coarseValue').value),
                fine_aggregate: parseFloat(document.getElementById('fineValue').value),
                age: parseInt(document.getElementById('ageValue').value)
            };

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const btn = document.querySelector('#predictorTab .btn');
            btn.disabled = true;
            btn.textContent = 'â³ é¢„æµ‹ä¸­...';

            try {
                const response = await fetch(`${API_BASE}/api/predict`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(params)
                });

                const data = await response.json();

                if (data.success) {
                    // æ˜¾ç¤ºé¢„æµ‹ç»“æœ
                    document.getElementById('predictedStrength').textContent = data.predicted_strength.toFixed(2);
                    document.getElementById('predictInterpretation').textContent = data.interpretation;
                    document.getElementById('predictResult').classList.add('active');

                    // æ˜¾ç¤ºæƒé‡å›¾
                    if (data.feature_weights) {
                        displayWeightsChart(data.feature_weights);
                    }

                    // æ»šåŠ¨åˆ°ç»“æœ
                    document.getElementById('predictResult').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    alert('é¢„æµ‹å¤±è´¥: ' + data.error);
                }

            } catch (error) {
                console.error('é¢„æµ‹å¤±è´¥:', error);
                alert('é¢„æµ‹å¤±è´¥ï¼š' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'ğŸš€ é¢„æµ‹å¼ºåº¦';
            }
        }

        // åŠ è½½å‚è€ƒæ‰¹æ¬¡
        async function loadSamples() {
            try {
                const response = await fetch(`${API_BASE}/api/samples`);
                const data = await response.json();
                
                const samplesGrid = document.getElementById('samplesGrid');
                samplesGrid.innerHTML = '';
                
                const categoryNames = {
                    'low': 'ğŸ”´ ä½å¼ºåº¦æ‰¹æ¬¡',
                    'medium': 'ğŸŸ¡ ä¸­ç­‰å¼ºåº¦æ‰¹æ¬¡',
                    'high': 'ğŸŸ¢ é«˜å¼ºåº¦æ‰¹æ¬¡',
                    'target': 'ğŸ¯ å›¾ç‰‡é…åˆæ¯”'
                };
                
                data.samples.forEach(sample => {
                    const card = document.createElement('div');
                    card.className = 'sample-card';
                    card.onclick = () => selectSample(sample.index, card);
                    
                    card.innerHTML = `
                        <h4>${categoryNames[sample.category]}</h4>
                        <div class="param">æ°´æ³¥: ${sample.cement.toFixed(0)} kg/mÂ³</div>
                        <div class="param">çŸ¿æ¸£: ${sample.blast_furnace_slag.toFixed(0)} kg/mÂ³</div>
                        <div class="param">æ°´: ${sample.water.toFixed(0)} kg/mÂ³</div>
                        <div class="param">é¾„æœŸ: ${sample.age} å¤©</div>
                        <div class="strength">å¼ºåº¦: ${sample.concrete_compressive_strength.toFixed(1)} MPa</div>
                    `;
                    samplesGrid.appendChild(card);
                });
            } catch (error) {
                console.error('åŠ è½½æ ·æœ¬å¤±è´¥:', error);
                document.getElementById('samplesGrid').innerHTML = 
                    '<div style="color: red;">åŠ è½½å¤±è´¥ï¼Œè¯·ç¡®ä¿APIæœåŠ¡å™¨å·²å¯åŠ¨</div>';
            }
        }

        // é€‰æ‹©æ ·æœ¬
        function selectSample(index, cardElement) {
            // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.sample-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // æ·»åŠ é€‰ä¸­çŠ¶æ€
            cardElement.classList.add('selected');
            selectedSampleIndex = index;
            
            console.log('å·²é€‰æ‹©æ‰¹æ¬¡:', index);
        }

        // å¡«å……ç¤ºä¾‹æŸ¥è¯¢
        function fillQuery(query) {
            document.getElementById('queryInput').value = query;
        }

        // æ‰§è¡Œåˆ†æ
        async function analyzeQuery() {
            const query = document.getElementById('queryInput').value.trim();
            
            if (!query) {
                alert('è¯·è¾“å…¥æ‚¨çš„é—®é¢˜');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading').classList.add('active');
            document.getElementById('resultSection').classList.remove('active');
            const analyzeBtn = document.querySelector('#analysisTab .btn');
            analyzeBtn.disabled = true;

            try {
                const payload = {
                    query: query,
                    reference_sample_index: selectedSampleIndex
                };

                console.log('å‘é€è¯·æ±‚:', payload);

                const response = await fetch(`${API_BASE}/api/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                console.log('æ”¶åˆ°å“åº”:', data);

                // æ˜¾ç¤ºç»“æœ
                displayResults(data);

            } catch (error) {
                console.error('åˆ†æå¤±è´¥:', error);
                alert('åˆ†æå¤±è´¥ï¼š' + error.message);
            } finally {
                document.getElementById('loading').classList.remove('active');
                const analyzeBtn = document.querySelector('#analysisTab .btn');
                analyzeBtn.disabled = false;
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults(data) {
            const analysisTypeMap = {
                'attribution': 'å½’å› åˆ†æ',
                'intervention': 'å¹²é¢„åˆ†æ',
                'counterfactual': 'åäº‹å®åˆ†æ'
            };

            const badgeClass = `badge-${data.analysis_type}`;
            
            document.getElementById('analysisType').innerHTML = 
                `<span class="badge ${badgeClass}">${analysisTypeMap[data.analysis_type]}</span>`;
            
            document.getElementById('targetVariable').textContent = data.target_variable;
            document.getElementById('analysisSummary').textContent = data.analysis_summary;
            document.getElementById('recommendations').textContent = data.recommendations;
            document.getElementById('detailedResults').textContent = 
                JSON.stringify(data.causal_results, null, 2);

            document.getElementById('resultSection').classList.add('active');
            
            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>

