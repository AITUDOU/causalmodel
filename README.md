# æ··å‡åœŸå¼ºåº¦å› æœåˆ†æç³»ç»Ÿ API æ–‡æ¡£

åŸºäºå› æœæ¨æ–­çš„æ··å‡åœŸé…åˆæ¯”æ™ºèƒ½åˆ†æç³»ç»Ÿï¼Œä½¿ç”¨è‡ªç„¶è¯­è¨€å³å¯å®Œæˆå› æœåˆ†æã€‚

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ ¸å¿ƒAPI](#æ ¸å¿ƒapi)
  - [å› æœåˆ†æ - å®Œæ•´å“åº”](#å› æœåˆ†æ---å®Œæ•´å“åº”)
  - [å› æœåˆ†æ - æµå¼å“åº”](#å› æœåˆ†æ---æµå¼å“åº”-æ¨è)
  - [ä½¿ç”¨åœºæ™¯å¯¹æ¯”](#ä½¿ç”¨åœºæ™¯å¯¹æ¯”)
- [å…¶ä»–API](#å…¶ä»–api)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡å™¨

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡ï¼ˆåˆ›å»º.envæ–‡ä»¶ï¼‰
OPENAI_API_KEY=your_api_key

# å¯åŠ¨æœåŠ¡
python3 api_server.py
```

æœåŠ¡å™¨åœ°å€ï¼šhttp://localhost:8000

### 2. å¿«é€Ÿæµ‹è¯•

è®¿é—® http://localhost:8000/test æ‰“å¼€APIæµ‹è¯•å·¥å…·ï¼Œç‚¹å‡»"åŠ è½½ç¤ºä¾‹"å³å¯å¿«é€Ÿä½“éªŒã€‚

---

## æ ¸å¿ƒAPI

ç³»ç»Ÿæä¾›ä¸¤ç§å› æœåˆ†æAPIï¼š**å®Œæ•´å“åº”**å’Œ**æµå¼å“åº”**ã€‚æ¨èä½¿ç”¨æµå¼å“åº”ï¼Œå¯å®æ—¶æŸ¥çœ‹åˆ†æè¿›åº¦ã€‚

### å› æœåˆ†æ - å®Œæ•´å“åº”

ç­‰å¾…åˆ†æå®Œæˆåè¿”å›å®Œæ•´ç»“æœã€‚é€‚åˆåå°æ‰¹å¤„ç†åœºæ™¯ã€‚

**ç«¯ç‚¹**: `POST /api/analyze`

#### ğŸ“‹ è¯·æ±‚å‚æ•°

```typescript
{
  query: string;                    // å¿…å¡«ï¼šè‡ªç„¶è¯­è¨€é—®é¢˜
  observed_config?: {               // å¯é€‰ï¼šè‡ªå®šä¹‰é…æ¯”
    cement, water, age, ...         // 8ä¸ªé…æ¯”å‚æ•°
  };
  reference_sample_index?: number;  // å¯é€‰ï¼šå‚è€ƒæ‰¹æ¬¡ï¼ˆé»˜è®¤æ ·æœ¬ï¼‰
  adjust_factors?: string[];        // å¯é€‰ï¼šæŒ‡å®šè°ƒæ•´çš„å˜é‡
  target_strength?: number;         // å¯é€‰ï¼šç›®æ ‡å¼ºåº¦ (MPa)
}
```

#### ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

**ç¤ºä¾‹1ï¼šçº¯é¢„æµ‹**ï¼ˆåªæƒ³çŸ¥é“å¼ºåº¦ï¼Œä¸éœ€è¦ä¼˜åŒ–å»ºè®®ï¼‰

```json
{
  "query": "é¢„æµ‹ä¸€ä¸‹å¼ºåº¦",
  "observed_config": {
    "cement": 300,
    "water": 185,
    "age": 28,
    ...
  }
}
```

**ç¤ºä¾‹2ï¼šæ¢ç´¢æ€§é—®é¢˜**ï¼ˆæƒ³çŸ¥é“å“ªäº›å› ç´ å½±å“å¼ºåº¦ï¼‰

```json
{
  "query": "å¦‚ä½•æé«˜å¼ºåº¦ï¼Ÿ"
}
```
â†’ ç³»ç»Ÿä¼šåˆ†ææ‰€æœ‰å› ç´ çš„å› æœæ•ˆåº”ï¼Œä½†**ä¸ä¼š**ç”Ÿæˆå…·ä½“é…æ¯”ï¼ˆå› ä¸ºæ²¡æœ‰æä¾›åŸºå‡†ï¼‰

**ç¤ºä¾‹3ï¼šä¼˜åŒ–é…æ¯”**ï¼ˆæƒ³å¾—åˆ°å…·ä½“çš„ä¼˜åŒ–æ–¹æ¡ˆï¼‰

```json
{
  "query": "å¦‚ä½•è¾¾åˆ°45 MPaï¼Ÿ",
  "observed_config": {
    "cement": 300,
    "water": 185,
    "age": 28,
    ...
  },
  "adjust_factors": ["cement", "fly_ash"],  // åªè°ƒæ•´è¿™ä¸¤ä¸ªå˜é‡
  "target_strength": 45                      // ç›®æ ‡å¼ºåº¦
}
```
â†’ ç³»ç»Ÿä¼šç”Ÿæˆå…·ä½“çš„ä¼˜åŒ–é…æ¯”æ–¹æ¡ˆ

**ç¤ºä¾‹4ï¼šåäº‹å®åˆ†æ**

```json
{
  "query": "æ°´æ³¥å¢åŠ 50ï¼Œå¼ºåº¦ä¼šæ€æ ·ï¼Ÿ",
  "reference_sample_index": 100
}
```

#### ğŸ“¤ å“åº”æ ¼å¼

```json
{
  "success": true,
  "analysis_type": "intervention | attribution | counterfactual",
  "causal_results": { ... },           // å› æœåˆ†ææ•°å€¼ç»“æœ
  "analysis_summary": "...",           // åˆ†ææ‘˜è¦
  "recommendations": "...",            // LLMç”Ÿæˆçš„å»ºè®®
  "optimized_config": { ... },         // ä¼˜åŒ–é…æ¯”ï¼ˆæœ‰æ˜ç¡®ç›®æ ‡æ—¶è¿”å›ï¼‰
  "predicted_strength": 45.0,          // é¢„æµ‹å¼ºåº¦ï¼ˆæœ‰ä¼˜åŒ–æ—¶è¿”å›ï¼‰
  "base_sample_info": { ... },         // åŸºå‡†æ ·æœ¬ä¿¡æ¯ï¼ˆä½¿ç”¨é»˜è®¤æ ·æœ¬æ—¶è¿”å›ï¼‰
  "error": null
}
```

---

### å› æœåˆ†æ - æµå¼å“åº” âœ¨ **æ¨è**

å®æ—¶æ¨é€åˆ†æè¿›åº¦ï¼Œæ¨èç”¨äºå‰ç«¯ç•Œé¢ã€‚

**ç«¯ç‚¹**: `POST /api/analyze_stream`

#### ğŸ“‹ è¯·æ±‚å‚æ•°

ä¸ `/api/analyze` å®Œå…¨ç›¸åŒã€‚

#### ğŸ“¡ å“åº”æ ¼å¼ (Server-Sent Events)

æµå¼è¿”å›å¤šä¸ªäº‹ä»¶ï¼š

```
data: {"type": "start", "message": "å¼€å§‹åˆ†æ..."}

data: {"type": "progress", "message": "ğŸ” Router Agent æ­£åœ¨åˆ†æ..."}

data: {"type": "progress", "message": "ğŸ“Š æ‰§è¡Œå› æœåˆ†æ..."}

data: {"type": "progress", "message": "ğŸ”§ ç”Ÿæˆä¼˜åŒ–é…æ¯”..."}

data: {"type": "result", "data": { å®Œæ•´ç»“æœ }}

data: {"type": "end", "message": "åˆ†æå®Œæˆ"}
```

#### ğŸ”§ å‰ç«¯ä½¿ç”¨ï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰

**HTMLç»“æ„**ï¼š
```html
<div id="progress-log"></div>
<div id="result-container"></div>
```

**JavaScriptå®ç°**ï¼š
```javascript
async function streamAnalyze(requestData) {
  const progressLog = document.getElementById('progress-log');
  const resultContainer = document.getElementById('result-container');
  
  // æ¸…ç©ºä¹‹å‰çš„å†…å®¹
  progressLog.innerHTML = '';
  resultContainer.innerHTML = '';
  
  try {
    const response = await fetch('http://localhost:8000/api/analyze_stream', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(requestData)
    });
    
    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    let buffer = '';
    
    while (true) {
      const { value, done } = await reader.read();
      if (done) break;
      
      buffer += decoder.decode(value, { stream: true });
      const lines = buffer.split('\n\n');
      buffer = lines.pop(); // ä¿ç•™ä¸å®Œæ•´çš„è¡Œ
      
      for (const line of lines) {
        if (line.startsWith('data: ')) {
          try {
            const event = JSON.parse(line.slice(6));
            
            if (event.type === 'start') {
              progressLog.innerHTML += `<div class="start">ğŸš€ ${event.message}</div>`;
            }
            else if (event.type === 'progress') {
              // æ£€æµ‹åˆ†éš”ç¬¦ï¼Œæ·»åŠ æ ·å¼
              const msg = event.message;
              if (msg.startsWith('â”€')) {
                progressLog.innerHTML += `<div class="separator-light">${msg}</div>`;
              } else if (msg.startsWith('â•')) {
                progressLog.innerHTML += `<div class="separator-bold">${msg}</div>`;
              } else if (msg === '') {
                progressLog.innerHTML += '<div class="blank-line">&nbsp;</div>';
              } else {
                // æ™®é€šè¿›åº¦æ¶ˆæ¯
                progressLog.innerHTML += `<div class="progress">${msg}</div>`;
              }
              // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
              progressLog.scrollTop = progressLog.scrollHeight;
            }
            else if (event.type === 'result') {
              // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
              const data = event.data;
              resultContainer.innerHTML = `
                <h3>åˆ†æç»“æœ</h3>
                <p><strong>åˆ†æç±»å‹ï¼š</strong>${data.analysis_type}</p>
                <p><strong>é¢„æµ‹å¼ºåº¦ï¼š</strong>${data.predicted_strength ? data.predicted_strength.toFixed(2) + ' MPa' : 'N/A'}</p>
                <pre>${JSON.stringify(data, null, 2)}</pre>
              `;
            }
            else if (event.type === 'end') {
              progressLog.innerHTML += `<div class="end">âœ… ${event.message}</div>`;
            }
            else if (event.type === 'error') {
              progressLog.innerHTML += `<div class="error">âŒ ${event.message}</div>`;
            }
          } catch (e) {
            console.error('è§£æäº‹ä»¶å¤±è´¥:', e);
          }
        }
      }
    }
  } catch (error) {
    progressLog.innerHTML += `<div class="error">âŒ è¿æ¥å¤±è´¥: ${error.message}</div>`;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
streamAnalyze({
  query: "å¦‚ä½•è¾¾åˆ°45 MPaï¼Ÿ",
  observed_config: {
    cement: 300,
    water: 185,
    age: 28,
    blast_furnace_slag: 0,
    fly_ash: 0,
    superplasticizer: 3,
    coarse_aggregate: 1050,
    fine_aggregate: 850
  },
  adjust_factors: ["cement", "fly_ash"],
  target_strength: 45
});
```

**CSSæ ·å¼ï¼ˆæ¨èï¼‰**ï¼š
```css
#progress-log {
  max-height: 500px;
  overflow-y: auto;
  background: #f5f5f5;
  padding: 15px;
  border-radius: 5px;
  font-family: 'Courier New', monospace;
  font-size: 14px;
  line-height: 1.6;
}

#progress-log .start {
  color: #1890ff;
  font-weight: bold;
}

#progress-log .progress {
  color: #333;
}

#progress-log .separator-light {
  color: #999;
  margin: 5px 0;
}

#progress-log .separator-bold {
  color: #52c41a;
  font-weight: bold;
  margin: 10px 0;
}

#progress-log .end {
  color: #52c41a;
  font-weight: bold;
  margin-top: 10px;
}

#progress-log .error {
  color: #ff4d4f;
  font-weight: bold;
}

#progress-log .blank-line {
  height: 1em;
}
```

**äº‹ä»¶ç±»å‹è¯´æ˜**ï¼š
- `start`: åˆ†æå¼€å§‹
- `progress`: è¿›åº¦æ¶ˆæ¯ï¼ˆåŒ…å«Agentæ‰§è¡ŒçŠ¶æ€ã€åˆ†éš”ç¬¦ã€ç©ºè¡Œç­‰ï¼‰
- `result`: å®Œæ•´çš„åˆ†æç»“æœJSON
- `end`: åˆ†æå®Œæˆ
- `error`: é”™è¯¯æ¶ˆæ¯

**å…³é”®å®ç°è¦ç‚¹**ï¼š

1. **ä½¿ç”¨bufferå¤„ç†ä¸å®Œæ•´æ•°æ®**ï¼š
   ```javascript
   let buffer = '';
   buffer += decoder.decode(value, { stream: true });
   const lines = buffer.split('\n\n');
   buffer = lines.pop(); // ä¿ç•™ä¸å®Œæ•´çš„è¡Œ
   ```

2. **è¯†åˆ«åˆ†éš”ç¬¦ç±»å‹**ï¼š
   - `â”€`ï¼ˆè½»åˆ†éš”ç¬¦ï¼‰ï¼šAgentä¹‹é—´çš„åˆ†éš”ï¼Œé¢œè‰²è¾ƒæ·¡
   - `â•`ï¼ˆé‡åˆ†éš”ç¬¦ï¼‰ï¼šåˆ†æå®Œæˆçš„æ ‡è®°ï¼Œé¢œè‰²é†’ç›®
   - ç©ºè¡Œï¼šå¢åŠ å¯è¯»æ€§

3. **è‡ªåŠ¨æ»šåŠ¨**ï¼š
   ```javascript
   progressLog.scrollTop = progressLog.scrollHeight;
   ```
   ç¡®ä¿ç”¨æˆ·å§‹ç»ˆçœ‹åˆ°æœ€æ–°è¿›åº¦

4. **é”™è¯¯å¤„ç†**ï¼š
   - æ•è·JSONè§£æé”™è¯¯
   - æ•è·ç½‘ç»œè¿æ¥é”™è¯¯
   - æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º

5. **è¶…æ—¶è®¾ç½®**ï¼ˆå¯é€‰ï¼‰ï¼š
   ```javascript
   const controller = new AbortController();
   setTimeout(() => controller.abort(), 180000); // 3åˆ†é’Ÿè¶…æ—¶
   
   fetch(url, {
     signal: controller.signal,
     ...
   });
   ```

**å®æ—¶æ•ˆæœ**ï¼š
```
ğŸš€ å¼€å§‹åˆ†æ...

ğŸ“‹ ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„è§‚æµ‹é…æ¯”
ğŸ¯ ç›®æ ‡å¼ºåº¦: 45 MPa

ğŸ” Router Agent æ­£åœ¨åˆ†ææ‚¨çš„é—®é¢˜...
ğŸ“‹ åˆ†æç±»å‹: intervention
...

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“Š Causal Analyst Agent æ­£åœ¨æ‰§è¡Œå› æœåˆ†æ...
...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… åˆ†æå®Œæˆ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

### ä½¿ç”¨åœºæ™¯å¯¹æ¯”

| åœºæ™¯ | query | observed_config | adjust_factors | target_strength | ç»“æœ |
|-----|-------|----------------|----------------|----------------|-----|
| **çº¯é¢„æµ‹** | "é¢„æµ‹å¼ºåº¦" | âœ… | âŒ | âŒ | åªè¿”å›é¢„æµ‹å€¼ |
| **æ¢ç´¢åˆ†æ** | "å¦‚ä½•æé«˜å¼ºåº¦ï¼Ÿ" | âŒ | âŒ | âŒ | è¿”å›å› ç´ åˆ†æï¼Œæ— å…·ä½“é…æ¯” |
| **ç²¾ç¡®ä¼˜åŒ–** | "å¦‚ä½•è¾¾åˆ°45 MPaï¼Ÿ" | âœ… | âœ… | âœ… | è¿”å›ä¼˜åŒ–é…æ¯”æ–¹æ¡ˆ |
| **åäº‹å®** | "æ°´æ³¥å¢åŠ 50" | âŒ | âŒ | âŒ | ä½¿ç”¨é»˜è®¤æ ·æœ¬åˆ†ææ•ˆæœ |

## å…¶ä»–API

ç³»ç»Ÿè¿˜æä¾›ä»¥ä¸‹è¾…åŠ©APIï¼š

### 1. å¼ºåº¦é¢„æµ‹
- **ç«¯ç‚¹**: `POST /api/predict`
- **ç”¨é€”**: ç›´æ¥é¢„æµ‹ç»™å®šé…æ¯”çš„å¼ºåº¦ï¼ˆæ— éœ€è‡ªç„¶è¯­è¨€ï¼‰
- **æ–‡æ¡£**: http://localhost:8000/docs

### 2. é…æ¯”ä¼˜åŒ–ï¼ˆGUIä¸“ç”¨ï¼‰
- **ç«¯ç‚¹**: `POST /api/optimize`
- **ç”¨é€”**: ç»“æ„åŒ–å‚æ•°ä¼˜åŒ–ï¼Œé€‚åˆGUIæ“ä½œ
- **è¯´æ˜**: å¦‚æœç”¨APIï¼Œæ¨èä½¿ç”¨`/api/analyze`ï¼ˆæ›´çµæ´»ï¼‰

### 3. å‚è€ƒæ‰¹æ¬¡
- **ç«¯ç‚¹**: `GET /api/samples`
- **ç”¨é€”**: è·å–é¢„è®¾çš„å‚è€ƒé…æ¯”æ ·æœ¬

### 4. å˜é‡ä¿¡æ¯
- **ç«¯ç‚¹**: `GET /api/variables`
- **ç”¨é€”**: æŸ¥è¯¢8ä¸ªé…æ¯”å‚æ•°çš„èŒƒå›´å’Œè¯´æ˜

### 5. å› æœå›¾ç»“æ„
- **ç«¯ç‚¹**: `GET /api/graph`
- **ç”¨é€”**: è·å–å› æœå›¾çš„èŠ‚ç‚¹å’Œè¾¹

**è¯¦ç»†æ–‡æ¡£**: è®¿é—® http://localhost:8000/docs æŸ¥çœ‹å®Œæ•´APIæ–‡æ¡£ï¼ˆSwagger UIï¼‰

---

## å¸¸è§é—®é¢˜

### 1. ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨`/api/analyze` vs `/api/analyze_stream`ï¼Ÿ

- **æ‰¹å¤„ç†/åå°ä»»åŠ¡**: ä½¿ç”¨ `/api/analyze`ï¼ˆç­‰å¾…å®Œæ•´ç»“æœï¼‰
- **å‰ç«¯ç•Œé¢/éœ€è¦å®æ—¶åé¦ˆ**: ä½¿ç”¨ `/api/analyze_stream` âœ¨ï¼ˆæ¨èï¼‰
  - ç”¨æˆ·å¯ä»¥çœ‹åˆ°å®æ—¶è¿›åº¦ï¼ˆRouter â†’ Analyst â†’ Optimizer â†’ Advisorï¼‰
  - é•¿æ—¶é—´åˆ†æä¸ä¼šæ„Ÿè§‰"å¡ä½"
  - æ”¯æŒæ ¼å¼åŒ–è¾“å‡ºï¼ˆåˆ†éš”ç¬¦ã€ç©ºè¡Œï¼‰
  - æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

### 2. ä¸ºä»€ä¹ˆæ²¡æœ‰è¿”å›`optimized_config`ï¼Ÿ

ç³»ç»Ÿåªåœ¨ä»¥ä¸‹æƒ…å†µç”Ÿæˆä¼˜åŒ–é…æ¯”ï¼š
1. æä¾›äº†åŸºå‡†é…æ¯”ï¼ˆ`observed_config`æˆ–`reference_sample_index`ï¼‰
2. æœ‰æ˜ç¡®çš„ç›®æ ‡ï¼ˆ`target_strength`æˆ–æŸ¥è¯¢ä¸­æåˆ°ç›®æ ‡å¼ºåº¦/æå‡æ¯”ä¾‹ï¼‰

**æ¢ç´¢æ€§é—®é¢˜**ï¼ˆå¦‚"å¦‚ä½•æé«˜å¼ºåº¦ï¼Ÿ"ï¼‰åªè¿”å›å› ç´ åˆ†æï¼Œä¸ç”Ÿæˆå…·ä½“é…æ¯”ã€‚

### 3. `adjust_factors`çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

æŒ‡å®šç³»ç»Ÿ**åªèƒ½è°ƒæ•´**è¿™äº›å˜é‡è¿›è¡Œä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼š

```json
{
  "query": "å¦‚ä½•è¾¾åˆ°45 MPaï¼Ÿ",
  "observed_config": {...},
  "adjust_factors": ["cement", "fly_ash"]
}
```

â†’ ç³»ç»Ÿåªä¼šè°ƒæ•´æ°´æ³¥å’Œç²‰ç…¤ç°ï¼Œå…¶ä»–å‚æ•°ä¿æŒä¸å˜ã€‚

### 4. ä»€ä¹ˆæ˜¯`base_sample_info`ï¼Ÿ

å½“æ‚¨æ²¡æœ‰æä¾›`observed_config`æˆ–`reference_sample_index`æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨é»˜è®¤æ ·æœ¬ä½œä¸ºåŸºå‡†ã€‚`base_sample_info`ä¼šå‘Šè¯‰æ‚¨ä½¿ç”¨çš„æ˜¯å“ªä¸ªæ ·æœ¬çš„å®Œæ•´é…æ¯”ä¿¡æ¯ã€‚

### 5. åˆ†æè€—æ—¶å¤šä¹…ï¼Ÿ

- **çº¯é¢„æµ‹/åäº‹å®åˆ†æ**: 5-15ç§’
- **å¹²é¢„åˆ†æ**: 10-30ç§’ï¼ˆå› æœæ•ˆåº”è®¡ç®—ï¼‰
- **ä¼˜åŒ–é…æ¯”**: 20-60ç§’ï¼ˆè¿­ä»£ä¼˜åŒ–ï¼‰

å»ºè®®è®¾ç½®è¶…æ—¶æ—¶é—´â‰¥180ç§’ï¼ˆ3åˆ†é’Ÿï¼‰ã€‚

### 6. å¦‚ä½•æµ‹è¯•APIï¼Ÿ

è®¿é—® http://localhost:8000/test ä½¿ç”¨å¯è§†åŒ–æµ‹è¯•å·¥å…·ï¼Œæ”¯æŒï¼š
- ä¸€é”®åŠ è½½ç¤ºä¾‹
- å®æ—¶æµå¼è¿›åº¦æ˜¾ç¤º
- å¤šé€‰æ¡†é€‰æ‹©è°ƒæ•´å˜é‡

### 7. æ”¯æŒå“ªäº›è‡ªç„¶è¯­è¨€è¡¨è¾¾ï¼Ÿ

**é¢„æµ‹ç±»**:
- "é¢„æµ‹å¼ºåº¦"ã€"è¿™ä¸ªé…æ¯”å¼ºåº¦æ˜¯å¤šå°‘"

**æ¢ç´¢ç±»**:
- "å¦‚ä½•æé«˜å¼ºåº¦ï¼Ÿ"ã€"å“ªäº›å› ç´ å½±å“å¼ºåº¦ï¼Ÿ"

**ä¼˜åŒ–ç±»**:
- "å¦‚ä½•è¾¾åˆ°45 MPaï¼Ÿ"ã€"æå‡10%åº”è¯¥æ€ä¹ˆè°ƒï¼Ÿ"

**åäº‹å®ç±»**:
- "æ°´æ³¥å¢åŠ 50"ã€"æ·»åŠ çŸ¿æ¸£100ï¼Œå‡å°‘æ°´æ³¥50"

ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«æ‚¨çš„æ„å›¾ï¼

---

## ç‰ˆæœ¬å†å²

### v2.3.0 (2025-11-09) - å½“å‰ç‰ˆæœ¬
- âœ… APIå‚æ•°ç²¾ç¡®æ§åˆ¶ï¼ˆ`adjust_factors`, `target_strength`ï¼‰
- âœ… æ™ºèƒ½æ„å›¾è¯†åˆ«ï¼ˆçº¯é¢„æµ‹ vs ä¼˜åŒ–ï¼‰
- âœ… APIæµ‹è¯•å·¥å…·ï¼ˆ`/test`ï¼‰
- âœ… åŸºå‡†æ ·æœ¬ä¿¡æ¯è¿”å›ï¼ˆ`base_sample_info`ï¼‰
- ğŸ› ä¿®å¤é™¤é›¶é”™è¯¯ã€å‚æ•°ä¼˜å…ˆçº§é—®é¢˜

### v2.2.0 (2025-11-06)
- GUIé©±åŠ¨çš„é…æ¯”ä¼˜åŒ–APIï¼ˆ`/api/optimize`ï¼‰

### v2.1.0 (2025-11-05)
- æµå¼å“åº”ï¼ˆ`/api/analyze_stream`ï¼‰
- æ•°å­¦è¿ç®—æ”¯æŒï¼ˆ"å¢åŠ 50"ã€"ç¿»å€"ç­‰ï¼‰

### v2.0.0 (2025-11-05)
- ç²¾ç¡®ç›®æ ‡æ§åˆ¶ï¼ˆäºŒåˆ†æœç´¢ä¼˜åŒ–ï¼‰
- ç”¨æˆ·è‡ªå®šä¹‰é…æ¯”è¾“å…¥

### v1.0.0 (2025-11-04)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ

---

## ğŸ”— èµ„æºé“¾æ¥

- **ä¸»ç•Œé¢**: http://localhost:8000
- **APIæµ‹è¯•å·¥å…·**: http://localhost:8000/test
- **APIæ–‡æ¡£**: http://localhost:8000/docs
- **æºä»£ç **: 
  - `api_server.py` - åç«¯æœåŠ¡
  - `src/causal_agent_system.py` - æ™ºèƒ½ä½“ç³»ç»Ÿ
  - `test_analyze_api.html` - æµ‹è¯•å·¥å…·

---

## ğŸ“Š é…æ¯”å‚æ•°èŒƒå›´

| å‚æ•° | ä¸­æ–‡å | èŒƒå›´ | å•ä½ |
|------|--------|------|------|
| `cement` | æ°´æ³¥ | 100-600 | kg/mÂ³ |
| `blast_furnace_slag` | é«˜ç‚‰çŸ¿æ¸£ | 0-400 | kg/mÂ³ |
| `fly_ash` | ç²‰ç…¤ç° | 0-250 | kg/mÂ³ |
| `water` | æ°´ | 100-300 | kg/mÂ³ |
| `superplasticizer` | å‡æ°´å‰‚ | 0-40 | kg/mÂ³ |
| `coarse_aggregate` | ç²—éª¨æ–™ | 700-1200 | kg/mÂ³ |
| `fine_aggregate` | ç»†éª¨æ–™ | 500-1100 | kg/mÂ³ |
| `age` | é¾„æœŸ | 1-365 | å¤© |

---

## ğŸ’» å¿«é€Ÿç¤ºä¾‹

### Python

```python
import requests
import json

# 1. æ¢ç´¢æ€§åˆ†æ
response = requests.post("http://localhost:8000/api/analyze", 
    json={"query": "å¦‚ä½•æé«˜å¼ºåº¦ï¼Ÿ"})
print(response.json())

# 2. ç²¾ç¡®ä¼˜åŒ–
response = requests.post("http://localhost:8000/api/analyze",
    json={
        "query": "å¦‚ä½•è¾¾åˆ°45 MPaï¼Ÿ",
        "observed_config": {
            "cement": 300, "water": 185, "age": 28,
            "blast_furnace_slag": 0, "fly_ash": 0,
            "superplasticizer": 3, "coarse_aggregate": 1050,
            "fine_aggregate": 850
        },
        "adjust_factors": ["cement", "fly_ash"],
        "target_strength": 45
    })
print(response.json())

# 3. æµå¼å“åº”ï¼ˆæ¨èï¼‰â­
response = requests.post("http://localhost:8000/api/analyze_stream",
    json={"query": "æå‡10%åº”è¯¥æ€ä¹ˆè°ƒï¼Ÿ", "reference_sample_index": 100},
    stream=True)

for line in response.iter_lines():
    if line and line.startswith(b'data: '):
        event = json.loads(line[6:])
        if event['type'] == 'progress':
            print(event['message'])  # å®æ—¶æ˜¾ç¤ºè¿›åº¦
        elif event['type'] == 'result':
            print("\nâœ… åˆ†æå®Œæˆ:", event['data'])
```

### JavaScript

```javascript
// æµå¼å“åº”ï¼ˆæ¨èï¼‰â­
async function analyze() {
  const response = await fetch('http://localhost:8000/api/analyze_stream', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      query: "å¦‚ä½•è¾¾åˆ°45 MPaï¼Ÿ",
      observed_config: {
        cement: 300, water: 185, age: 28,
        blast_furnace_slag: 0, fly_ash: 0,
        superplasticizer: 3, coarse_aggregate: 1050,
        fine_aggregate: 850
      },
      adjust_factors: ["cement", "fly_ash"],
      target_strength: 45
    })
  });
  
  const reader = response.body.getReader();
  const decoder = new TextDecoder();
  let buffer = '';
  
  while (true) {
    const { value, done } = await reader.read();
    if (done) break;
    
    buffer += decoder.decode(value, { stream: true });
    const lines = buffer.split('\n\n');
    buffer = lines.pop();
    
    for (const line of lines) {
      if (line.startsWith('data: ')) {
        const event = JSON.parse(line.slice(6));
        if (event.type === 'progress') {
          console.log(event.message);  // å®æ—¶è¿›åº¦
        } else if (event.type === 'result') {
          console.log('âœ… å®Œæˆ:', event.data);
        }
      }
    }
  }
}

analyze();
```

### cURL

```bash
# 1. æ¢ç´¢æ€§åˆ†æ
curl -X POST http://localhost:8000/api/analyze \
  -H "Content-Type: application/json" \
  -d '{"query": "å¦‚ä½•æé«˜å¼ºåº¦ï¼Ÿ"}'

# 2. ç²¾ç¡®ä¼˜åŒ–
curl -X POST http://localhost:8000/api/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "query": "å¦‚ä½•è¾¾åˆ°45 MPaï¼Ÿ",
    "observed_config": {
      "cement": 300, "water": 185, "age": 28,
      "blast_furnace_slag": 0, "fly_ash": 0,
      "superplasticizer": 3, "coarse_aggregate": 1050,
      "fine_aggregate": 850
    },
    "adjust_factors": ["cement", "fly_ash"],
    "target_strength": 45
  }'

# 3. æµå¼å“åº”ï¼ˆæ¨èï¼‰â­ 
# -N å‚æ•°ç¦ç”¨ç¼“å†²ï¼Œå®æ—¶æ˜¾ç¤ºè¾“å‡º
curl -N -X POST http://localhost:8000/api/analyze_stream \
  -H "Content-Type: application/json" \
  -d '{
    "query": "æå‡10%åº”è¯¥æ€ä¹ˆè°ƒï¼Ÿ",
    "reference_sample_index": 100
  }'

# æµå¼å“åº”ä¼šè¾“å‡ºç±»ä¼¼ï¼š
# data: {"type": "start", "message": "å¼€å§‹åˆ†æ..."}
# data: {"type": "progress", "message": "ğŸ” Router Agent æ­£åœ¨åˆ†æ..."}
# data: {"type": "progress", "message": "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"}
# data: {"type": "result", "data": {...}}
# data: {"type": "end", "message": "åˆ†æå®Œæˆ"}
```

---

## ğŸ”¬ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯

- **å› æœæ¨æ–­**: åŸºäºDoWhyå’ŒGCMï¼Œæ”¯æŒå¹²é¢„ã€å½’å› ã€åäº‹å®åˆ†æ
- **æ™ºèƒ½ä½“ç³»ç»Ÿ**: LangGraphå¤šAgentåä½œï¼ˆRouter â†’ Analyst â†’ Optimizer â†’ Advisorï¼‰
- **ä¼˜åŒ–ç®—æ³•**: äºŒåˆ†æœç´¢ + å› æœæ•ˆåº”åˆ†æï¼Œç²¾åº¦Â±2%
- **æ•°æ®æ¥æº**: UCIçœŸå®æ•°æ®é›†ï¼ˆ1030æ ·æœ¬ï¼ŒRÂ²=0.99ï¼‰

### æ¨¡å‹æ€§èƒ½

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| RÂ² | 0.9901 |
| MAE | 1.28 MPa |
| MAPE | 3.76% |

---

## âœ¨ æ–°åŠŸèƒ½äº®ç‚¹

### ğŸ¯ GUIé©±åŠ¨çš„æ™ºèƒ½é…æ¯”ä¼˜åŒ–ï¼ˆv2.2æ–°å¢ï¼‰

**é—®é¢˜**: ä¼ ç»Ÿçš„è‡ªç„¶è¯­è¨€åˆ†ææ–¹å¼å¯¹äºGUIæ“ä½œä¸å¤Ÿå‹å¥½ï¼Œç”¨æˆ·éœ€è¦æ„é€ å¤æ‚çš„é—®å¥ï¼Œä¸”ç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©è¦è°ƒæ•´çš„å˜é‡ï¼Œæ— æ³•ç²¾ç¡®æ§åˆ¶ã€‚

**è§£å†³æ–¹æ¡ˆ**: 
- **ä¸“ç”¨APIç«¯ç‚¹** (`/api/optimize`): æ¥æ”¶ç»“æ„åŒ–å‚æ•°ï¼Œç›´æ¥è¿”å›ä¼˜åŒ–ç»“æœ
- **ä¸‰æ­¥éª¤äº¤äº’æµç¨‹**: åŸºå‡†é…æ¯” â†’ é¢„æµ‹å¼ºåº¦ â†’ é€‰æ‹©å› ç´  â†’ ä¼˜åŒ–ç»“æœ
- **ç”¨æˆ·ç²¾ç¡®æ§åˆ¶**: ç”¨æˆ·é€šè¿‡å¤é€‰æ¡†æ˜ç¡®æŒ‡å®šå“ªäº›å› ç´ å¯ä»¥è°ƒæ•´
- **åŠ¨æ€èŒƒå›´è°ƒæ•´**: åŸºäºåŸºå‡†å¼ºåº¦è‡ªåŠ¨è®¾ç½®ç›®æ ‡å¼ºåº¦çš„åˆç†èŒƒå›´

**å·¥ä½œæµç¨‹**:
```
1. ç”¨æˆ·è¾“å…¥åŸºå‡†é…æ¯”ï¼ˆæˆ–é€‰æ‹©é¢„è®¾ï¼‰â†’ ç³»ç»Ÿé¢„æµ‹åŸºå‡†å¼ºåº¦ï¼ˆå¦‚30.5 MPaï¼‰
2. ç”¨æˆ·æ»‘åŠ¨é€‰æ‹©ç›®æ ‡å¼ºåº¦ï¼ˆæ»‘å—èŒƒå›´è‡ªåŠ¨è®¾ä¸º30-60 MPaï¼‰
3. ç”¨æˆ·å‹¾é€‰å…è®¸è°ƒæ•´çš„å› ç´ ï¼ˆå¦‚ï¼šâ˜‘ï¸ æ°´æ³¥ã€â˜‘ï¸ ç²‰ç…¤ç°ï¼‰
4. ç‚¹å‡»"å¼€å§‹æ™ºèƒ½ä¼˜åŒ–" â†’ ç³»ç»Ÿåªè°ƒæ•´é€‰ä¸­çš„å› ç´ ï¼Œè¾¾åˆ°ç›®æ ‡å¼ºåº¦
```

**æŠ€æœ¯ç‰¹ç‚¹**:
- **åŒé‡ä¼˜åŒ–è·¯å¾„**: 
  - è‡ªç„¶è¯­è¨€è·¯å¾„ï¼š`/api/analyze` - é€‚åˆæ™ºèƒ½é—®ç­”
  - GUIé©±åŠ¨è·¯å¾„ï¼š`/api/optimize` - é€‚åˆç•Œé¢æ“ä½œ
- **ç²¾ç¡®å› ç´ æ§åˆ¶**: åªè°ƒæ•´ç”¨æˆ·æŒ‡å®šçš„å˜é‡ï¼ˆå¦‚åªè°ƒæ•´æ°´æ³¥+ç²‰ç…¤ç°ï¼‰
- **ç»“æ„åŒ–å“åº”**: è¿”å›è°ƒæ•´è¯¦æƒ…ã€å®Œæ•´é…æ¯”ã€å·¥ç¨‹å»ºè®®
- **å¿«é€Ÿå“åº”**: 10-20ç§’ï¼ˆè·³è¿‡è‡ªç„¶è¯­è¨€ç†è§£ï¼‰

**æ•ˆæœå¯¹æ¯”**:
```
ä¼ ç»Ÿæ–¹å¼ (/api/analyze):
- è¾“å…¥: "æˆ‘æƒ³å¼ºåº¦è¾¾åˆ°45 MPaï¼Œæ°´æ³¥å’Œç²‰ç…¤ç°åº”è¯¥æ€ä¹ˆè°ƒï¼Ÿ"
- é—®é¢˜: éœ€è¦æ„é€ å¤æ‚é—®å¥ï¼Œç³»ç»Ÿå¯èƒ½è‡ªåŠ¨é€‰æ‹©Top 3å˜é‡ï¼ˆä¸ä¸€å®šæ˜¯ç”¨æˆ·æƒ³è¦çš„ï¼‰
- è€—æ—¶: 15-30ç§’ï¼ˆå«LLMå¤„ç†ï¼‰

æ–°æ–¹å¼ (/api/optimize):
- è¾“å…¥: {base_config: {...}, target_strength: 45, adjust_factors: ["cement", "fly_ash"]}
- ä¼˜åŠ¿: ç»“æ„åŒ–å‚æ•°ï¼Œç²¾ç¡®æŒ‡å®šè°ƒæ•´å› ç´ ï¼Œè¿”å›å®Œæ•´è°ƒæ•´è¯¦æƒ…
- è€—æ—¶: 10-20ç§’ï¼ˆæ— LLMï¼Œçº¯å› æœæ¨æ–­ï¼‰
```

**å‰ç«¯äº¤äº’**:
- âœ… æ­¥éª¤1ï¼šé¢„è®¾é…æ¯”æŒ‰é’®ï¼ˆC30/C40/C50/ä½æ°´èƒ¶æ¯”ï¼‰+ æ‰‹åŠ¨è¾“å…¥
- âœ… æ­¥éª¤2ï¼šç›®æ ‡å¼ºåº¦æ»‘å—ï¼ˆå¸¦å®æ—¶æ•°å€¼æ˜¾ç¤ºï¼‰
- âœ… æ­¥éª¤3ï¼š8ä¸ªå› ç´ çš„å¤é€‰æ¡†ï¼ˆå¸¦emojiå›¾æ ‡ï¼‰
- âœ… ç»“æœå±•ç¤ºï¼šåŸºå‡†vsä¼˜åŒ–å¯¹æ¯”è¡¨æ ¼ + å®Œæ•´é…æ¯”å¡ç‰‡

### ğŸ”¥ æ™ºèƒ½æ•°å­¦è®¡ç®—å·¥å…·ï¼ˆv2.1æ–°å¢ï¼‰

**é—®é¢˜**: ä¼ ç»Ÿæ–¹æ³•åªæ”¯æŒç»å¯¹å€¼å¹²é¢„ï¼ˆå¦‚"æ°´ç”¨é‡150"ï¼‰ï¼Œæ— æ³•å¤„ç†ç›¸å¯¹å˜åŒ–ï¼ˆå¦‚"å¢åŠ 50"ï¼‰å’Œå¤æ‚çš„å¤šå˜é‡è¿ç®—ã€‚

**è§£å†³æ–¹æ¡ˆ**: 
- **Math Calculator Tool**: ä¸“é—¨çš„æ•°å­¦è¿ç®—å·¥å…·ï¼Œæ”¯æŒåŠ å‡ä¹˜é™¤å››åˆ™è¿ç®—
- **æ™ºèƒ½è¯†åˆ«**: Router Agentè‡ªåŠ¨è¯†åˆ«"å¢åŠ "ã€"å‡å°‘"ã€"ç¿»å€"ç­‰è‡ªç„¶è¯­è¨€è¡¨è¾¾
- **å¤šå˜é‡ååŒ**: ä¸€æ¬¡å¤„ç†å¤šä¸ªå˜é‡çš„å¤æ‚è¿ç®—ï¼ˆå¦‚"æ·»åŠ çŸ¿æ¸£100ï¼Œå‡å°‘æ°´æ³¥50"ï¼‰

**æ”¯æŒçš„è¿ç®—**:
| è‡ªç„¶è¯­è¨€ | è¿ç®—ç±»å‹ | å¤„ç†æ–¹å¼ |
|---------|---------|---------|
| "å¢åŠ 50"ã€"æ·»åŠ 100" | `add` | `æ–°å€¼ = åŸå€¼ + æ“ä½œæ•°` |
| "å‡å°‘30"ã€"é™ä½20" | `subtract` | `æ–°å€¼ = åŸå€¼ - æ“ä½œæ•°` |
| "ç¿»å€"ã€"ä¹˜ä»¥2" | `multiply` | `æ–°å€¼ = åŸå€¼ Ã— æ“ä½œæ•°` |
| "å‡åŠ"ã€"é™¤ä»¥2" | `divide` | `æ–°å€¼ = åŸå€¼ Ã· æ“ä½œæ•°` |

**æ•ˆæœå¯¹æ¯”**:
```
ä¼ ç»Ÿæ–¹æ³•: "æ·»åŠ çŸ¿æ¸£100ï¼Œå‡å°‘æ°´æ³¥50" â†’ âŒ ç†è§£ä¸ºç»å¯¹å€¼ï¼ŒçŸ¿æ¸£=100ï¼Œæ°´æ³¥=-50
æ–°æ–¹æ³•:   "æ·»åŠ çŸ¿æ¸£100ï¼Œå‡å°‘æ°´æ³¥50" â†’ âœ… çŸ¿æ¸£ = 190 + 100 = 290ï¼Œæ°´æ³¥ = 162 - 50 = 112
```

### ğŸ”¥ æµå¼å“åº”ï¼ˆv2.1æ–°å¢ï¼‰

**é—®é¢˜**: ä¼ ç»ŸAPIåœ¨é•¿æ—¶é—´åˆ†ææ—¶ï¼Œç”¨æˆ·æ— æ³•çœ‹åˆ°è¿›åº¦ï¼Œä½“éªŒä¸ä½³ï¼Œå®¹æ˜“è¯¯è®¤ä¸º"å¡ä½"ã€‚

**è§£å†³æ–¹æ¡ˆ**: 
- **Server-Sent Events**: ä½¿ç”¨SSEåè®®å®æ—¶æ¨é€Agentæ‰§è¡ŒçŠ¶æ€
- **å¯è§†åŒ–è¿›åº¦**: å‰ç«¯æ˜¾ç¤º"ğŸ“¡ å®æ—¶åˆ†æè¿›åº¦"åŒºåŸŸï¼Œå±•ç¤ºæ¯ä¸ªæ­¥éª¤
- **æ›´å¥½ä½“éªŒ**: ç”¨æˆ·å¯çœ‹åˆ°Routerã€Analystã€Optimizerã€Advisorå„Agentçš„æ‰§è¡Œæƒ…å†µ

**æ¨é€å†…å®¹**:
```
ğŸ“¡ ğŸ” Router Agent æ­£åœ¨åˆ†ææ‚¨çš„é—®é¢˜...
ğŸ“¡ ğŸ“‹ åˆ†æç±»å‹: intervention
ğŸ“¡ ğŸ“Š Causal Analyst Agent æ­£åœ¨æ‰§è¡Œå› æœåˆ†æ...
ğŸ“¡ æ‰§è¡Œå¹²é¢„åˆ†æ...
ğŸ“¡ ğŸ”§ Optimizer Agent æ­£åœ¨ç”Ÿæˆä¼˜åŒ–é…æ¯”...
ğŸ“¡   è¿­ä»£ 1: scale=0.250, é¢„æµ‹=52.91 MPa
ğŸ“¡   è¿­ä»£ 2: scale=0.125, é¢„æµ‹=48.81 MPa
ğŸ“¡ ğŸ’¡ Advisor Agent æ­£åœ¨ç”Ÿæˆå†³ç­–å»ºè®®...
âœ… åˆ†æå®Œæˆ
```

### ğŸ¯ ç²¾ç¡®ç›®æ ‡æ§åˆ¶ï¼ˆv2.0ï¼‰

**é—®é¢˜**: ä¼ ç»Ÿæ–¹æ³•ç®€å•åœ°å¯¹Topå˜é‡è°ƒæ•´10%ï¼Œå¯¼è‡´ç´¯ç§¯æ•ˆåº”è¿‡å¤§ï¼Œæ— æ³•è¾¾åˆ°ç”¨æˆ·çš„ç²¾ç¡®ç›®æ ‡ã€‚

**è§£å†³æ–¹æ¡ˆ**: 
- **æ™ºèƒ½æå–ç›®æ ‡**: ä»"æå‡10%"ã€"å¢åŠ 5%"ç­‰è‡ªç„¶è¯­è¨€ä¸­æå–ç²¾ç¡®ç™¾åˆ†æ¯”
- **äºŒåˆ†æœç´¢ä¼˜åŒ–**: è¿­ä»£è°ƒæ•´å˜é‡æ¯”ä¾‹ï¼Œç›´åˆ°é¢„æµ‹å¼ºåº¦è¾¾åˆ°ç›®æ ‡ï¼ˆè¯¯å·®â‰¤2%ï¼‰
- **å¤šå˜é‡ååŒ**: åŒæ—¶ä¼˜åŒ–Top 3æœ‰æ•ˆå˜é‡ï¼Œè€ƒè™‘å˜é‡é—´çš„ååŒæ•ˆåº”

**æ•ˆæœå¯¹æ¯”**:
```
ä¼ ç»Ÿæ–¹æ³•: ç›®æ ‡10% â†’ å®é™…44.9% âŒ (è¯¯å·®+34.9%)
æ–°æ–¹æ³•:   ç›®æ ‡10% â†’ å®é™…10.1% âœ… (è¯¯å·®+0.1%)
```

### ğŸ“ ç”¨æˆ·è‡ªå®šä¹‰é…æ¯”è¾“å…¥ï¼ˆv2.0ï¼‰

**åŠŸèƒ½**: ç”¨æˆ·å¯ä»¥ç›´æ¥è¾“å…¥ä»»æ„é…æ¯”è¿›è¡Œåäº‹å®åˆ†æï¼Œæ— éœ€é€‰æ‹©é¢„è®¾çš„å‚è€ƒæ‰¹æ¬¡ã€‚

**ä¼˜åŠ¿**:
- âœ… çµæ´»æ€§æ›´é«˜ï¼ˆæ”¯æŒä»»æ„é…æ¯”ç»„åˆï¼‰
- âœ… è‡ªåŠ¨é¢„æµ‹åŸºå‡†å¼ºåº¦ï¼ˆç³»ç»Ÿè‡ªåŠ¨è¡¥å…¨ç¼ºå¤±çš„å¼ºåº¦å€¼ï¼‰
- âœ… å®æ—¶åˆ†æï¼ˆæ— éœ€ç­‰å¾…æ•°æ®åº“æŸ¥è¯¢ï¼‰

### ğŸ“Š å®Œæ•´å‚è€ƒæ‰¹æ¬¡ä¿¡æ¯ï¼ˆv2.0ï¼‰

**æ˜¾ç¤ºå†…å®¹**: æ¯ä¸ªå‚è€ƒæ‰¹æ¬¡å¡ç‰‡æ˜¾ç¤ºå®Œæ•´çš„8ä¸ªé…æ¯”å‚æ•°
- æ°´æ³¥ã€é«˜ç‚‰çŸ¿æ¸£ã€ç²‰ç…¤ç°
- æ°´ã€é«˜æ•ˆå‡æ°´å‰‚
- ç²—éª¨æ–™ã€ç»†éª¨æ–™
- é¾„æœŸ + å¼ºåº¦

**å¸ƒå±€ä¼˜åŒ–**: 2åˆ—ç½‘æ ¼å¸ƒå±€ï¼Œä¿¡æ¯å¯†åº¦æå‡50%

---

## ğŸ“š ç›¸å…³èµ„æº

- **Webä¸»ç•Œé¢**: http://localhost:8000
- **APIæµ‹è¯•å·¥å…·**: http://localhost:8000/test ğŸ”¥ **v2.3æ–°å¢**
- **Swaggeræ–‡æ¡£**: http://localhost:8000/docs
- **ReDocæ–‡æ¡£**: http://localhost:8000/redoc
- **æºä»£ç **: 
  - åç«¯æœåŠ¡ï¼š`api_server.py`
  - æ™ºèƒ½ä½“ç³»ç»Ÿï¼š`src/causal_agent_system.py`
  - æµ‹è¯•å·¥å…·ï¼š`test_analyze_api.html`
- **æµ‹è¯•è„šæœ¬**: `test_optimizer.py`

---

## ğŸ“ ç‰ˆæœ¬æ›´æ–°æ—¥å¿—

### v2.3.0 (2025-11-09) ğŸ¯

**é‡å¤§æ›´æ–°ï¼šAPIç²¾ç¡®æ§åˆ¶ + æ™ºèƒ½æ„å›¾è¯†åˆ« + æµ‹è¯•å·¥å…·**

**æ–°å¢åŠŸèƒ½**:
- ğŸ¯ **APIå‚æ•°ç²¾ç¡®æ§åˆ¶**: `/api/analyze` æ–°å¢ `adjust_factors` å’Œ `target_strength` å‚æ•°
  - âœ… **ä¼˜å…ˆçº§æœºåˆ¶**: APIå‚æ•°ä¼˜å…ˆäºLLMè§£æç»“æœ
  - âœ… **ç²¾ç¡®æ§åˆ¶**: æ˜ç¡®æŒ‡å®šå“ªäº›å˜é‡å¯è°ƒæ•´ã€ç›®æ ‡å¼ºåº¦æ˜¯å¤šå°‘
  - âœ… **æœ€ä½³å®è·µ**: ç»“åˆè‡ªç„¶è¯­è¨€+ç»“æ„åŒ–å‚æ•°ï¼Œçµæ´»æ€§ä¸ç²¾ç¡®æ€§å…¼å¾—
- ğŸ§ª **APIæµ‹è¯•å·¥å…·**: æ–°å¢ `/test` ç«¯ç‚¹ï¼Œæä¾›å¯è§†åŒ–æµ‹è¯•ç•Œé¢
  - âœ… **æµå¼åˆ†ææŒ‰é’®**: å®æ—¶æŸ¥çœ‹Agentæ‰§è¡Œè¿›åº¦ï¼ˆæ¨èä½¿ç”¨ï¼‰
  - âœ… **ä¸‰æ ‡ç­¾é¡µè®¾è®¡**: åŸºç¡€å‚æ•°ã€è§‚æµ‹é…æ¯”ã€é«˜çº§é€‰é¡¹
  - âœ… **å¤šé€‰æ¡†æ§åˆ¶**: å¯è§†åŒ–é€‰æ‹©è¦è°ƒæ•´çš„å˜é‡
  - âœ… **ä¸€é”®ç¤ºä¾‹**: å¿«é€ŸåŠ è½½å®Œæ•´æµ‹è¯•ç”¨ä¾‹
- ğŸ¤– **æ™ºèƒ½æ„å›¾è¯†åˆ«**: è‡ªåŠ¨åŒºåˆ†çº¯é¢„æµ‹vsä¼˜åŒ–éœ€æ±‚
  - âœ… **çº¯é¢„æµ‹å…³é”®è¯**: "é¢„æµ‹"ã€"é¢„æŠ¥"ã€"å¼ºåº¦æ˜¯å¤šå°‘"ã€"èƒ½è¾¾åˆ°"
  - âœ… **ä¼˜åŒ–å…³é”®è¯**: "ä¼˜åŒ–"ã€"æå‡"ã€"æ”¹è¿›"ã€"è°ƒæ•´"ã€"å¢åŠ "ã€"é™ä½"
  - âœ… **æ™ºèƒ½åˆ¤æ–­**: "é¢„æµ‹ä¸€ä¸‹å¼ºåº¦" â†’ åªè¿”å›é¢„æµ‹å€¼ï¼Œä¸è¿›è¡Œä¼˜åŒ–
  - âœ… **é¿å…è¿‡åº¦ä¼˜åŒ–**: ç”¨æˆ·æ²¡è¦æ±‚æ—¶ä¸è‡ªåŠ¨ä¼˜åŒ–é…æ¯”

**Bugä¿®å¤**:
- ğŸ› ä¿®å¤APIå‚æ•°è¢«LLMè§£æç»“æœè¦†ç›–çš„é—®é¢˜
- ğŸ› ä¿®å¤çº¯é¢„æµ‹æŸ¥è¯¢è¢«è¯¯åˆ¤ä¸ºä¼˜åŒ–çš„é—®é¢˜
- ğŸ› ä¿®å¤å˜é‡å€¼ä¸º0æ—¶é™¤ä»¥é›¶é”™è¯¯ï¼ˆå¦‚ fly_ash=0ï¼‰
- ğŸ› ä¿®å¤æµå¼å“åº”ä¸­å­—ç¬¦ä¸²æ‹¼æ¥é”™è¯¯

**ç”¨æˆ·ä½“éªŒä¼˜åŒ–**:
- â±ï¸ é»˜è®¤è¶…æ—¶æ—¶é—´ï¼š60ç§’ â†’ 180ç§’ï¼ˆ3åˆ†é’Ÿï¼‰
- ğŸ“Š æµå¼è¿›åº¦æ˜¾ç¤ºï¼šå®æ—¶å±•ç¤ºRouterã€Analystã€Optimizerã€Advisoræ‰§è¡ŒçŠ¶æ€
- ğŸ’¡ è¶…æ—¶é”™è¯¯æç¤ºï¼šè¯¦ç»†è¯´æ˜å’Œè§£å†³å»ºè®®
- ğŸ¨ å˜é‡å€¼ä¸º0æ—¶æ˜¾ç¤ºç»å¯¹å˜åŒ–é‡ï¼ˆå¦‚ "+45.3 kg/mÂ³"ï¼‰è€Œéç™¾åˆ†æ¯”

**æŠ€æœ¯æ”¹è¿›**:
- ğŸ”§ Router Agentå‚æ•°ä¼˜å…ˆçº§ï¼š`api_specified_variables` > `parsed_specified_variables`
- ğŸ”§ Router Agentå‚æ•°ä¼˜å…ˆçº§ï¼š`api_target_value` > `parsed_target_value`
- ğŸ”§ Optimizer Agentæ„å›¾è¯†åˆ«ï¼šæ£€æµ‹çº¯é¢„æµ‹å…³é”®è¯ï¼Œé¿å…ä¸å¿…è¦çš„ä¼˜åŒ–
- ğŸ”§ Optimizer Agenté™¤é›¶ä¿æŠ¤ï¼šå®‰å…¨å¤„ç†å˜é‡å€¼ä¸º0çš„æƒ…å†µ
- ğŸ”§ æµ‹è¯•å·¥å…·å®ç°ï¼šå®Œæ•´çš„HTML+JavaScriptå‰ç«¯ï¼Œæ”¯æŒSSEæµå¼å“åº”

**APIå˜æ›´**:
- æ–°å¢ `GET /test` ç«¯ç‚¹ï¼ˆAPIæµ‹è¯•å·¥å…·ï¼‰
- `QueryRequest` æ–°å¢å­—æ®µï¼š
  - `adjust_factors`: å¯é€‰ï¼Œè¦è°ƒæ•´çš„å˜é‡åˆ—è¡¨
  - `target_strength`: å¯é€‰ï¼Œç›®æ ‡å¼ºåº¦å€¼
- Router Agentå¢å¼ºï¼šä¼˜å…ˆä½¿ç”¨APIä¼ å…¥çš„å‚æ•°

**ä½¿ç”¨åœºæ™¯å¯¹æ¯”**:

**åœºæ™¯1ï¼šçº¯é¢„æµ‹** âœ…
```json
{
  "query": "é¢„æµ‹ä¸€ä¸‹å¼ºåº¦",
  "observed_config": {...}
}
â†’ åªè¿”å›å½“å‰é…æ¯”çš„é¢„æµ‹å¼ºåº¦ï¼ˆä¸è¿›è¡Œä¼˜åŒ–ï¼‰
```

**åœºæ™¯2ï¼šè‡ªç„¶è¯­è¨€ä¼˜åŒ–** 
```json
{
  "query": "å¦‚ä½•æå‡å¼ºåº¦åˆ°45 MPaï¼Ÿ",
  "observed_config": {...}
}
â†’ LLMè‡ªåŠ¨é€‰æ‹©Top 3å˜é‡è¿›è¡Œä¼˜åŒ–
```

**åœºæ™¯3ï¼šç²¾ç¡®æ§åˆ¶ä¼˜åŒ–** ğŸ¯ **æ¨è**
```json
{
  "query": "å¦‚ä½•æå‡å¼ºåº¦åˆ°45 MPaï¼Ÿ",
  "observed_config": {...},
  "adjust_factors": ["cement", "fly_ash"],
  "target_strength": 45
}
â†’ åªè°ƒæ•´æŒ‡å®šçš„å˜é‡ï¼Œè¾¾åˆ°æŒ‡å®šç›®æ ‡
```

**æ€§èƒ½æŒ‡æ ‡**:
- å“åº”æ—¶é—´ï¼š10-30ç§’ï¼ˆè§†åˆ†æç±»å‹è€Œå®šï¼‰
- æµå¼å»¶è¿Ÿï¼š< 1ç§’ï¼ˆå®æ—¶æ¨é€è¿›åº¦ï¼‰
- å‚æ•°ä¼˜å…ˆçº§ï¼š100%ç”Ÿæ•ˆ
- æ„å›¾è¯†åˆ«å‡†ç¡®ç‡ï¼š> 95%

---

### v2.2.0 (2025-11-06) ğŸ¯

**é‡å¤§æ›´æ–°ï¼šGUIé©±åŠ¨çš„æ™ºèƒ½é…æ¯”ä¼˜åŒ–**

**æ–°å¢åŠŸèƒ½**:
- ğŸ¯ **æ™ºèƒ½é…æ¯”ä¼˜åŒ–API** (`/api/optimize`): ä¸“ä¸ºGUIç•Œé¢è®¾è®¡çš„ç›´æ¥ä¼˜åŒ–ç«¯ç‚¹
  - âœ… ä¸‰æ­¥éª¤å·¥ä½œæµï¼šè®¾ç½®åŸºå‡†é…æ¯” â†’ é¢„æµ‹åŸºå‡†å¼ºåº¦ â†’ é€‰æ‹©è°ƒæ•´å› ç´  â†’ è·å¾—ä¼˜åŒ–æ–¹æ¡ˆ
  - âœ… ç”¨æˆ·ç²¾ç¡®æ§åˆ¶ï¼šåªè°ƒæ•´ç”¨æˆ·å‹¾é€‰çš„å› ç´ ï¼ˆå¦‚æ°´æ³¥+ç²‰ç…¤ç°ï¼‰
  - âœ… åŠ¨æ€ç›®æ ‡èŒƒå›´ï¼šåŸºäºåŸºå‡†å¼ºåº¦æ™ºèƒ½è°ƒæ•´ç›®æ ‡å¼ºåº¦æ»‘å—èŒƒå›´
  - âœ… ç»“æ„åŒ–å“åº”ï¼šè¿”å›å®Œæ•´çš„è°ƒæ•´è¯¦æƒ…ã€ä¼˜åŒ–é…æ¯”ã€å·¥ç¨‹å»ºè®®
- ğŸ¨ **å‰ç«¯UIé‡è®¾è®¡**: å› æœåˆ†æé¡µé¢å…¨æ–°äº¤äº’ä½“éªŒ
  - âœ… æ­¥éª¤1ï¼šé¢„è®¾é…æ¯”/æ‰‹åŠ¨è¾“å…¥ â†’ é¢„æµ‹åŸºå‡†å¼ºåº¦
  - âœ… æ­¥éª¤2ï¼šæ»‘å—é€‰æ‹©ç›®æ ‡å¼ºåº¦ï¼ˆèŒƒå›´è‡ªåŠ¨é€‚é…ï¼‰
  - âœ… æ­¥éª¤3ï¼šå¤šé€‰æ¡†å‹¾é€‰è¦è°ƒæ•´çš„å› ç´ 
  - âœ… ç»“æœå±•ç¤ºï¼šåŸºå‡†vsä¼˜åŒ–å¯¹æ¯”ã€è°ƒæ•´è¯¦æƒ…è¡¨æ ¼

**æŠ€æœ¯æ”¹è¿›**:
- ğŸ”§ æ–°å¢ `OptimizeRequest` å’Œ `OptimizeResponse` Pydanticæ¨¡å‹
- ğŸ”§ äºŒåˆ†æœç´¢ç®—æ³•ä¼˜åŒ–ï¼šåªè°ƒæ•´ç”¨æˆ·æŒ‡å®šçš„å› ç´ ï¼Œæœ€å¤š10æ¬¡è¿­ä»£
- ğŸ”§ å› æœåˆ†æç³»ç»Ÿå¢å¼ºï¼šæ”¯æŒ `specified_variables` å’Œ `target_value`
- ğŸ”§ Router Agentæ”¹è¿›ï¼šè¯†åˆ«ç”¨æˆ·æŒ‡å®šçš„è°ƒæ•´å˜é‡å’Œç›®æ ‡å¼ºåº¦

**APIå˜æ›´**:
- æ–°å¢ `POST /api/optimize` ç«¯ç‚¹ï¼ˆGUIé©±åŠ¨ä¼˜åŒ–ï¼‰
- `CausalAnalysisState` æ–°å¢ `specified_variables` å’Œ `target_value` å­—æ®µ
- Optimizer Agentä¼˜å…ˆä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„å˜é‡è¿›è¡Œä¼˜åŒ–

**ç”¨æˆ·ä½“éªŒæå‡**:
- æ›´ç›´è§‚ï¼šå¯è§†åŒ–çš„ä¸‰æ­¥éª¤å¼•å¯¼æµç¨‹
- æ›´å¿«é€Ÿï¼š10-20ç§’å®Œæˆä¼˜åŒ–ï¼ˆæ— éœ€è‡ªç„¶è¯­è¨€å¤„ç†ï¼‰
- æ›´ç²¾ç¡®ï¼šç”¨æˆ·å®Œå…¨æ§åˆ¶å“ªäº›å› ç´ å¯ä»¥è°ƒæ•´
- æ›´å®ç”¨ï¼šæ˜¾ç¤ºå®Œæ•´çš„è°ƒæ•´è¯¦æƒ…å’Œå·¥ç¨‹å»ºè®®

**æ€§èƒ½æŒ‡æ ‡**:
- å“åº”æ—¶é—´ï¼š10-20ç§’
- ç²¾åº¦æ§åˆ¶ï¼šç›®æ ‡å¼ºåº¦Â±2%è¯¯å·®
- æ”¯æŒå› ç´ ï¼š8ä¸ªé…æ¯”å‚æ•°ä»»æ„ç»„åˆ

---

### v2.1.0 (2025-11-05) ğŸ”¥

**é‡å¤§æ›´æ–°ï¼šæ•°å­¦è®¡ç®—å·¥å…· + æµå¼å“åº”**

**æ–°å¢åŠŸèƒ½**:
- ğŸ”¥ **Math Calculator Tool**: æ™ºèƒ½æ•°å­¦è¿ç®—æ”¯æŒï¼ˆåŠ å‡ä¹˜é™¤ï¼‰ï¼Œè‡ªåŠ¨å¤„ç†å¤šå˜é‡å¤æ‚è°ƒæ•´
  - âœ… "æ°´æ³¥å¢åŠ 50" â†’ `add` æ“ä½œ
  - âœ… "æ·»åŠ çŸ¿æ¸£100ï¼Œå‡å°‘æ°´æ³¥50" â†’ å¤šå˜é‡ååŒè¿ç®—
  - âœ… "é¾„æœŸç¿»å€" â†’ `multiply` æ“ä½œ
- ğŸ”¥ **æµå¼å“åº”API** (`/api/analyze_stream`): ä½¿ç”¨Server-Sent Eventså®æ—¶æ¨é€Agentæ‰§è¡Œè¿›åº¦
  - âœ… å®æ—¶åé¦ˆï¼šç”¨æˆ·å¯çœ‹åˆ°æ¯ä¸ªAgentçš„æ‰§è¡ŒçŠ¶æ€
  - âœ… æ›´å¥½ä½“éªŒï¼šé•¿æ—¶é—´åˆ†æä¸ä¼š"å¡ä½"
  - âœ… è°ƒè¯•å‹å¥½ï¼šæ¸…æ™°å±•ç¤ºæ¯æ­¥è¾“å‡º

**æŠ€æœ¯æ”¹è¿›**:
- ğŸ”§ æ–°å¢ `math_calculator_tool`: ä¸“é—¨å¤„ç†å˜é‡çš„åŠ å‡ä¹˜é™¤è¿ç®—
- ğŸ”§ Router Agentå¢å¼ºï¼šæ™ºèƒ½è¯†åˆ«è¿ç®—ç±»å‹ï¼ˆadd/subtract/multiply/divideï¼‰å¹¶æå–æ“ä½œæ•°
- ğŸ”§ Causal Analyst Agentä¼˜åŒ–ï¼šé›†æˆæ•°å­¦è®¡ç®—å·¥å…·ï¼Œæ”¯æŒå•å˜é‡å’Œå¤šå˜é‡è¿ç®—
- ğŸ”§ UIä¼˜åŒ–ï¼šç§»é™¤å†—ä½™çš„åˆ†éš”çº¿ï¼Œç®€åŒ–è¾“å‡ºï¼Œå†³ç­–å»ºè®®ä¸å†é‡å¤æ˜¾ç¤º

**APIå˜æ›´**:
- æ–°å¢ `POST /api/analyze_stream` ç«¯ç‚¹ï¼ˆæµå¼å“åº”ï¼‰
- Routeræ”¯æŒæå– `operation` å’Œ `operand` å­—æ®µï¼ˆæ•°å­¦è¿ç®—å‚æ•°ï¼‰
- Routeræ”¯æŒæå– `interventions` åˆ—è¡¨ï¼ˆå¤šå˜é‡è¿ç®—ï¼‰

**ç”¨æˆ·ä½“éªŒæå‡**:
- å‰ç«¯å®æ—¶æ˜¾ç¤ºåˆ†æè¿›åº¦ï¼ˆğŸ“¡ å®æ—¶åˆ†æè¿›åº¦åŒºåŸŸï¼‰
- æ”¯æŒæ›´è‡ªç„¶çš„é—®é¢˜è¡¨è¾¾ï¼ˆ"å¢åŠ "ã€"å‡å°‘"ã€"ç¿»å€"ç­‰å£è¯­åŒ–è¡¨è¾¾ï¼‰
- è‡ªåŠ¨è¯†åˆ«å¹¶æ‰§è¡Œå¤æ‚çš„å¤šå˜é‡æ•°å­¦è¿ç®—

---

### v2.0.0 (2025-11-05) ğŸ¯

**é‡å¤§æ›´æ–°ï¼šç²¾ç¡®ç›®æ ‡æ§åˆ¶ä¼˜åŒ–**

**æ–°å¢åŠŸèƒ½**:
- âœ¨ **ç›®æ ‡å¯¼å‘ä¼˜åŒ–**: æ”¯æŒç²¾ç¡®æ§åˆ¶å¼ºåº¦æå‡ç›®æ ‡ï¼ˆå¦‚"æå‡10%"ï¼‰ï¼Œä½¿ç”¨äºŒåˆ†æœç´¢ç®—æ³•è‡ªåŠ¨ç”Ÿæˆæœ€ä¼˜é…æ¯”
- âœ¨ **ç”¨æˆ·è‡ªå®šä¹‰é…æ¯”è¾“å…¥**: ç”¨æˆ·å¯ç›´æ¥è¾“å…¥ä»»æ„é…æ¯”è¿›è¡Œåäº‹å®åˆ†æï¼Œç³»ç»Ÿè‡ªåŠ¨é¢„æµ‹åŸºå‡†å¼ºåº¦
- âœ¨ **å®Œæ•´å‚è€ƒæ‰¹æ¬¡æ˜¾ç¤º**: å‚è€ƒæ‰¹æ¬¡å¡ç‰‡æ˜¾ç¤ºå…¨éƒ¨8ä¸ªé…æ¯”å‚æ•°ï¼Œ2åˆ—ç½‘æ ¼å¸ƒå±€

**æŠ€æœ¯æ”¹è¿›**:
- ğŸ”§ Router Agentå¢å¼ºï¼šæ™ºèƒ½æå–ç›®æ ‡æå‡ç™¾åˆ†æ¯”
- ğŸ”§ Optimizer Agenté‡å†™ï¼šäºŒåˆ†æœç´¢ç®—æ³•å®ç°ç²¾ç¡®ä¼˜åŒ–ï¼ˆ8æ¬¡è¿­ä»£ï¼Œè¯¯å·®â‰¤2%ï¼‰
- ğŸ”§ Causal Analyst Agentä¼˜åŒ–ï¼šæ”¯æŒç”¨æˆ·è¾“å…¥é…æ¯”çš„åäº‹å®åˆ†æ

**APIå˜æ›´**:
- `POST /api/analyze` æ–°å¢ `observed_config` å­—æ®µï¼ˆç”¨æˆ·è‡ªå®šä¹‰é…æ¯”ï¼‰
- å“åº”æ–°å¢ `optimized_config`ã€`predicted_strength`ã€`optimization_summary` å­—æ®µ

**æ€§èƒ½æŒ‡æ ‡**:
- ç›®æ ‡ç²¾ç¡®åº¦ï¼šÂ±2% è¯¯å·®èŒƒå›´å†…
- ä¼˜åŒ–é€Ÿåº¦ï¼š8æ¬¡è¿­ä»£å†…æ”¶æ•›
- é€‚ç”¨èŒƒå›´ï¼š5%-50%å¼ºåº¦æå‡

---

### v1.0.0 (2025-11-04)

**åˆå§‹ç‰ˆæœ¬å‘å¸ƒ**

- åŸºç¡€å¼ºåº¦é¢„æµ‹åŠŸèƒ½
- ä¸‰ç§å› æœåˆ†æï¼ˆå½’å› ã€å¹²é¢„ã€åäº‹å®ï¼‰
- ç‰¹å¾æƒé‡å¯è§†åŒ–
- Webäº¤äº’ç•Œé¢
- RESTful API

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ‘¥ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

